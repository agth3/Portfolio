<!DOCTYPE html>
<html lang="fr">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Portfolio</title>
        <link rel="stylesheet" href="style.css">
        <!-- <link rel="preload" href="/fonts/myfont.woff2" as="font" type="font/woff2" crossorigin="anonymous"> -->
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    </head>

    <body>
        <div class="container-menu-projets">
            <!-- <div class="cadre bord-haut"></div> -->
            <!-- <div class="bloc-accueil"> -->
                    <a class="a-menu logo-menu" href="index.html"></a>
                    <div class="elements-menu-haut" id="nom-menu"><a class="a-menu" href="index.html">Agathe Cotton</a></div>
                    <div class="elements-menu-haut" id="bio-menu"><a class="a-menu highlight-projet" href="bio.html">Bio</a></div>
                    <div class="elements-menu-haut" id="projet-menu"><a class="a-menu highlight-projet" href="mosaique.html">Projets</a></div>
                    <div class="elements-menu-haut" id="lang-menu">FR / ENG</div>
                    <div class="elements-menu-bas highlight-projet" id="tel-menu">06 89 32 68 76</div>
                    <div class="elements-menu-bas" id="mail-menu">agathe.cotton@gmail.com</div>
                    <div class="elements-menu-bas" id="insta-menu"><a class="a-menu highlight-projet" href="https://www.instagram.com/happy_factoryy/?hl=fr" target="_blank">@happy_factoryy</a></div>

                    <button class="fleches-sections-projets" id="fleche-gauche-projets">ᐸ</button>
                    <button class="fleches-sections-projets" id="fleche-droite-projets">ᐳ</button>
        </div>
            <!-- </div> -->
            <!-- <div class="cadre bord-bas"></div>
            <div class="cadre bord-droit"></div>
            <div class="cadre bord-gauche"></div> -->

            <!-- <div class="center-grid"></div> -->
        <div class="container-projets" id="container-projets">                
            <section class="grid-projets" id="projet-OffKey">
                <div class="zone-texte-projets" id="projet-OffKey">
                    <h2 class="titre-projets" id="titre-OffKey">OffKey</h2>
                    <span class="date-projets">2024</span>
                    <span class="description-projets">Identité visuelle générative d’un festival fictif de musique techno basée sur des visuels génératifs programmés en p5.js</br>
Esthétique glauque, organique et rythmique incarnée par le mille-pattes</br>
Déclinaison sur multiples supports (affiches, réseaux sociaux, badges, produits dérivés...)</span>
                    <span class="outil-projets">Outils mobilisés : VS Code - p5.js, Figma, Indesign, Illustrator</span>
                    <span class="contexte-projets">Projet réalisé lors d’un semestre erasmus à Politecnico di Milano</br>
avec Luca SCHARRENBACH</span>
                </div>
                <div class="section-slide">
                  <div class="carrousel-container">
                    <div class="scroll-capture"></div> <!-- zone invisible pour capter le scroll -->
                    <div class="carrousel-track">
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                    </div>
                    <div class="previous-frame"></div>
                    <div class="focus-frame"></div>
                    <div class="next-frame"></div>
                    <div class="scroll-indicator"></div>
                  </div>
                </div>
            </section>

            <section class="grid-projets" id="projet-OffKey-2">
                <div class="zone-texte-projets" id="projet-OffKey-2">
                    <h2 class="titre-projets" id="titre-OffKey-2">OffKey</h2>
                    <span class="date-projets">2024</span>
                    <span class="description-projets">Identité visuelle générative d’un festival fictif de musique techno basée sur des visuels génératifs programmés en p5.js</br>
Esthétique glauque, organique et rythmique incarnée par le mille-pattes</br>
Déclinaison sur multiples supports (affiches, réseaux sociaux, badges, produits dérivés...)</span>
                    <span class="outil-projets">Outils mobilisés : VS Code - p5.js, Figma, Indesign, Illustrator</span>
                    <span class="contexte-projets">Projet réalisé lors d’un semestre erasmus à Politecnico di Milano</br>
avec Luca SCHARRENBACH</span>
                </div>
                <div class="section-slide">
                  <div class="carrousel-container">
                    <div class="scroll-capture"></div>
                    <div class="carrousel-track">
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                    </div>
                    <div class="previous-frame"></div>
                    <div class="focus-frame"></div>
                    <div class="next-frame"></div>
                    <div class="scroll-indicator"></div>
                  </div>
                </div>
            </section>

            <section class="grid-projets" id="projet-OffKey-3">
                <div class="zone-texte-projets" id="projet-OffKey-3">
                    <h2 class="titre-projets" id="titre-OffKey-3">OffKey</h2>
                    <span class="date-projets">2024</span>
                    <span class="description-projets">Identité visuelle générative d’un festival fictif de musique techno basée sur des visuels génératifs programmés en p5.js</br>
Esthétique glauque, organique et rythmique incarnée par le mille-pattes</br>
Déclinaison sur multiples supports (affiches, réseaux sociaux, badges, produits dérivés...)</span>
                    <span class="outil-projets">Outils mobilisés : VS Code - p5.js, Figma, Indesign, Illustrator</span>
                    <span class="contexte-projets">Projet réalisé lors d’un semestre erasmus à Politecnico di Milano</br>
avec Luca SCHARRENBACH</span>
                </div>
                <div class="section-slide">
                  <div class="carrousel-container">
                    <div class="scroll-capture"></div>
                    <div class="carrousel-track">
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                    </div>
                    <div class="previous-frame"></div>
                    <div class="focus-frame"></div>
                    <div class="next-frame"></div>
                    <div class="scroll-indicator"></div>
                  </div>
                </div>
            </section>
        </div>

    </body>

<script>

  //    GESTION DES SLIDES AVEC FLECHES

  const container = document.getElementById("container-projets");
  const btnLeft = document.getElementById("fleche-gauche-projets");
  const btnRight = document.getElementById("fleche-droite-projets");
  const sections = document.querySelectorAll(".grid-projets");

  const sectionWidth = window.innerWidth;
  let currentIndex = 0;

  function updateButtons() {
    btnLeft.disabled = currentIndex === 0;
    btnRight.disabled = currentIndex === sections.length - 1;
  }

  function scrollToIndex(index) {
    const scrollX = index * sectionWidth;
    container.scrollTo({ left: scrollX, behavior: "smooth" });
    currentIndex = index;
    updateButtons();
  }

  btnLeft.addEventListener("click", () => {
    if (currentIndex > 0) {
      scrollToIndex(currentIndex - 1);
    }
  });

  btnRight.addEventListener("click", () => {
    if (currentIndex < sections.length - 1) {
      scrollToIndex(currentIndex + 1);
    }
  });

  // Auto-calcule la section visible au scroll manuel
  container.addEventListener("scroll", () => {
    const newIndex = Math.round(container.scrollLeft / sectionWidth);
    if (newIndex !== currentIndex) {
      currentIndex = newIndex;
      updateButtons();
    }
  });

  window.addEventListener("resize", () => {
  scrollToIndex(currentIndex); // recentre sur la bonne section
});
  // Initialisation
  updateButtons();




//    ADAPTATION DES TEINTES DE HIGHLIGHT PAR SECTION AFFICHEE



  // const sections = document.querySelectorAll(".grid-projets"); déjà déclarée plus haut

  // Associe chaque ID de section à une couleur
  const sectionColors = {
    "projet-OffKey": "#e74c3c",    // Rouge
    "projet-OffKey-2": "#3498db",   // Bleu
    "projet-OffKey-3": "#67d92a",  // Vert
    // Ajoute d'autres IDs ici
  };

  // Fonction appelée à chaque changement de visibilité
  function handleIntersection(entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const sectionId = entry.target.id;
        const color = sectionColors[sectionId];

        if (color) {
          document.documentElement.style.setProperty('--highlight-color', color);
        }
      }
    });
  }

  // Crée l'observer
  const observer = new IntersectionObserver(handleIntersection, {
    root: document.querySelector('#container-projets'), // horizontal scrolling container
    rootMargin: '0px',
    threshold: 0.6, // 60% visible dans le viewport horizontal
  });

  // Observe chaque section
  sections.forEach(section => observer.observe(section));


//    CARROUSEL INFINI DES IMG

  class VerticalCarousel {
    constructor(trackElement) {
      this.track = trackElement;
      this.slides = Array.from(trackElement.querySelectorAll('.carrousel-slide'));
      this.slideHeight = window.innerHeight - 2 * this.getVh(16.667);
      this.originalSlideCount = this.slides.length; // 6 images uniques
      this.currentIndex = 0; // Index dans les vraies images (0 à originalSlideCount-1)
      this.isScrolling = false;
      this.scrollThreshold = 50;
      this.scrollAccumulator = 0;

      this.init();
      this.bindEvents();
    }

    getVh(vh) {
      return window.innerHeight * (vh / 100);
    }

    init() {
      this.currentIndex = 0;
      const focusFrameOffset = this.getVh(16.667);
      this.track.style.transform = `translateY(${focusFrameOffset}px)`;
      this.updateScrollIndicator();
    }

    scrollToSlide(direction) {
      if (this.isScrolling) return;

      this.isScrolling = true;
      
      // Boucle infinie simple
      this.currentIndex += direction;
      
      if (this.currentIndex >= this.originalSlideCount) {
        this.currentIndex = 0;
      } else if (this.currentIndex < 0) {
        this.currentIndex = this.originalSlideCount - 1;
      }
      
      // Position corrigée avec espacement entre les images
      const focusFrameOffset = this.getVh(16.667);
      const gap = this.getVh(4.63); // l'espacement entre images
      const slideWithGap = this.slideHeight + gap;
      const targetPosition = focusFrameOffset - (this.currentIndex * slideWithGap);

      this.track.style.transition = 'transform 0.6s ease';
      this.track.style.transform = `translateY(${targetPosition}px)`;

      setTimeout(() => {
        this.updateScrollIndicator();
        this.isScrolling = false;
      }, 600);
    }

    updateScrollIndicator() {
      const indicator = this.track.closest('.carrousel-container').querySelector('.scroll-indicator');
      if (!indicator) return;

      const progress = (this.currentIndex / (this.originalSlideCount - 1)) * (100 - 20);
      indicator.style.setProperty('--scroll-progress', `${progress}px`);
    }

    

    bindEvents() {
      const scrollZone = this.track.closest('.carrousel-container').querySelector('.scroll-capture');

      let startY = 0;
      let scrollY = 0;

      // Souris
      scrollZone.addEventListener('wheel', (e) => {
        e.preventDefault();
        console.log('🎯 Scroll détecté', e.deltaY);
        if (this.isScrolling) return;

        this.scrollAccumulator += e.deltaY;

        if (Math.abs(this.scrollAccumulator) >= this.scrollThreshold) {
          const direction = this.scrollAccumulator > 0 ? 1 : -1;
          this.scrollToSlide(direction);
          this.scrollAccumulator = 0;
        }
      }, { passive: false });

      // Mobile
      scrollZone.addEventListener('touchstart', (e) => {
        startY = e.touches[0].clientY;
        scrollY = 0;
      }, { passive: true });

      scrollZone.addEventListener('touchmove', (e) => {
        e.preventDefault();
        scrollY = e.touches[0].clientY - startY;
      }, { passive: false });

      scrollZone.addEventListener('touchend', () => {
        if (Math.abs(scrollY) > this.scrollThreshold) {
          const direction = scrollY > 0 ? -1 : 1;
          this.scrollToSlide(direction);
        }
      }, { passive: true });
    }
  }

  // Lancer tous les carrousels au DOM prêt
  document.addEventListener('DOMContentLoaded', () => {
    const tracks = document.querySelectorAll('.carrousel-track');
    tracks.forEach(track => {
      new VerticalCarousel(track);
    });

    // Injecte style pour .scroll-indicator::after
    const style = document.createElement('style');
    style.textContent = `
      .scroll-indicator::after {
        top: var(--scroll-progress, 0px);
      }
    `;
    document.head.appendChild(style);
  });

</script>


</html>