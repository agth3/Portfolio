<!DOCTYPE html>
<html lang="fr">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Portfolio</title>
        <link rel="stylesheet" href="style.css">
        <!-- <link rel="preload" href="/fonts/myfont.woff2" as="font" type="font/woff2" crossorigin="anonymous"> -->
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    </head>

    <body>
        <div class="container-menu-projets">
            <!-- <div class="cadre bord-haut"></div> -->
            <!-- <div class="bloc-accueil"> -->
                    <a class="a-menu logo-menu" href="index.html"></a>
                    <div class="elements-menu-haut" id="nom-menu"><a class="a-menu" href="index.html">Agathe Cotton</a></div>
                    <div class="elements-menu-haut" id="bio-menu"><a class="a-menu highlight-projet" href="bio.html">Bio</a></div>
                    <div class="elements-menu-haut" id="projet-menu"><a class="a-menu highlight-projet" href="mosaique.html">Projets</a></div>
                    <div class="elements-menu-haut" id="lang-menu">FR / ENG</div>
                    <div class="elements-menu-bas highlight-projet" id="tel-menu">06 89 32 68 76</div>
                    <div class="elements-menu-bas" id="mail-menu">agathe.cotton@gmail.com</div>
                    <div class="elements-menu-bas" id="insta-menu"><a class="a-menu highlight-projet" href="https://www.instagram.com/happy_factoryy/?hl=fr" target="_blank">@happy_factoryy</a></div>

                    <button class="fleches-sections-projets" id="fleche-gauche-projets">ᐸ</button>
                    <button class="fleches-sections-projets" id="fleche-droite-projets">ᐳ</button>
        </div>
            <!-- </div> -->
            <!-- <div class="cadre bord-bas"></div>
            <div class="cadre bord-droit"></div>
            <div class="cadre bord-gauche"></div> -->

            <!-- <div class="center-grid"></div> -->
        <div class="container-projets" id="container-projets">                
            <section class="grid-projets" id="projet-OffKey">
                <div class="zone-texte-projets" id="projet-OffKey">
                    <h2 class="titre-projets" id="titre-OffKey">OffKey</h2>
                    <span class="date-projets">2024</span>
                    <span class="description-projets">Identité visuelle générative d’un festival fictif de musique techno basée sur des visuels génératifs programmés en p5.js</br>
Esthétique glauque, organique et rythmique incarnée par le mille-pattes</br>
Déclinaison sur multiples supports (affiches, réseaux sociaux, badges, produits dérivés...)</span>
                    <span class="outil-projets">Outils mobilisés : VS Code - p5.js, Figma, Indesign, Illustrator</span>
                    <span class="contexte-projets">Projet réalisé lors d’un semestre erasmus à Politecnico di Milano</br>
avec Luca SCHARRENBACH</span>
                </div>
                <div class="section-slide">
                  <div class="carrousel-container">
                    <div class="scroll-capture"></div> <!-- zone invisible pour capter le scroll -->
                    <div class="carrousel-track">
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Clone Image 1.6"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1.1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 1.2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 1.3"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1.4"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 1.5"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 1.6"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Clone Image 1.1"></div>
                    </div>
                    <div class="previous-frame"></div>
                    <div class="focus-frame"></div>
                    <div class="next-frame"></div>
                    <div class="scroll-indicator"></div>
                  </div>
                </div>
            </section>

            <section class="grid-projets" id="projet-OffKey-2">
                <div class="zone-texte-projets" id="projet-OffKey-2">
                    <h2 class="titre-projets" id="titre-OffKey-2">OffKey</h2>
                    <span class="date-projets">2024</span>
                    <span class="description-projets">Identité visuelle générative d’un festival fictif de musique techno basée sur des visuels génératifs programmés en p5.js</br>
Esthétique glauque, organique et rythmique incarnée par le mille-pattes</br>
Déclinaison sur multiples supports (affiches, réseaux sociaux, badges, produits dérivés...)</span>
                    <span class="outil-projets">Outils mobilisés : VS Code - p5.js, Figma, Indesign, Illustrator</span>
                    <span class="contexte-projets">Projet réalisé lors d’un semestre erasmus à Politecnico di Milano</br>
avec Luca SCHARRENBACH</span>
                </div>
                <div class="section-slide">
                  <div class="carrousel-container">
                    <div class="scroll-capture"></div>
                    <div class="carrousel-track">
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                    </div>
                    <div class="previous-frame"></div>
                    <div class="focus-frame"></div>
                    <div class="next-frame"></div>
                    <div class="scroll-indicator"></div>
                  </div>
                </div>
            </section>

            <section class="grid-projets" id="projet-OffKey-3">
                <div class="zone-texte-projets" id="projet-OffKey-3">
                    <h2 class="titre-projets" id="titre-OffKey-3">OffKey</h2>
                    <span class="date-projets">2024</span>
                    <span class="description-projets">Identité visuelle générative d’un festival fictif de musique techno basée sur des visuels génératifs programmés en p5.js</br>
Esthétique glauque, organique et rythmique incarnée par le mille-pattes</br>
Déclinaison sur multiples supports (affiches, réseaux sociaux, badges, produits dérivés...)</span>
                    <span class="outil-projets">Outils mobilisés : VS Code - p5.js, Figma, Indesign, Illustrator</span>
                    <span class="contexte-projets">Projet réalisé lors d’un semestre erasmus à Politecnico di Milano</br>
avec Luca SCHARRENBACH</span>
                </div>
                <div class="section-slide">
                  <div class="carrousel-container">
                    <div class="scroll-capture"></div>
                    <div class="carrousel-track">
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/20231005_154014.png" alt="Image 1"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Posterwall.png" alt="Image 2"></div>
                      <div class="carrousel-slide"><img src="asset/img/low/Insta_Post-Feed.png" alt="Image 3"></div>
                    </div>
                    <div class="previous-frame"></div>
                    <div class="focus-frame"></div>
                    <div class="next-frame"></div>
                    <div class="scroll-indicator"></div>
                  </div>
                </div>
            </section>
        </div>

    </body>

<script>

  //    GESTION DES SLIDES AVEC FLECHES

  const container = document.getElementById("container-projets");
  const btnLeft = document.getElementById("fleche-gauche-projets");
  const btnRight = document.getElementById("fleche-droite-projets");
  const sections = document.querySelectorAll(".grid-projets");

  const sectionWidth = window.innerWidth;
  let currentIndex = 0;

  function updateButtons() {
    btnLeft.disabled = currentIndex === 0;
    btnRight.disabled = currentIndex === sections.length - 1;
  }

  function scrollToIndex(index) {
    const scrollX = index * sectionWidth;
    container.scrollTo({ left: scrollX, behavior: "smooth" });
    currentIndex = index;
    updateButtons();
  }

  btnLeft.addEventListener("click", () => {
    if (currentIndex > 0) {
      scrollToIndex(currentIndex - 1);
    }
  });

  btnRight.addEventListener("click", () => {
    if (currentIndex < sections.length - 1) {
      scrollToIndex(currentIndex + 1);
    }
  });

  // Auto-calcule la section visible au scroll manuel
  container.addEventListener("scroll", () => {
    const newIndex = Math.round(container.scrollLeft / sectionWidth);
    if (newIndex !== currentIndex) {
      currentIndex = newIndex;
      updateButtons();
    }
  });

  window.addEventListener("resize", () => {
  scrollToIndex(currentIndex); // recentre sur la bonne section
});
  // Initialisation
  updateButtons();




//    ADAPTATION DES TEINTES DE HIGHLIGHT PAR SECTION AFFICHEE



  // const sections = document.querySelectorAll(".grid-projets"); déjà déclarée plus haut

  // Associe chaque ID de section à une couleur
  const sectionColors = {
    "projet-OffKey": "#e74c3c",    // Rouge
    "projet-OffKey-2": "#3498db",   // Bleu
    "projet-OffKey-3": "#67d92a",  // Vert
    // Ajoute d'autres IDs ici
  };

  // Fonction appelée à chaque changement de visibilité
  function handleIntersection(entries) {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const sectionId = entry.target.id;
        const color = sectionColors[sectionId];

        if (color) {
          document.documentElement.style.setProperty('--highlight-color', color);
        }
      }
    });
  }

  // Crée l'observer
  const observer = new IntersectionObserver(handleIntersection, {
    root: document.querySelector('#container-projets'), // horizontal scrolling container
    rootMargin: '0px',
    threshold: 0.6, // 60% visible dans le viewport horizontal
  });

  // Observe chaque section
  sections.forEach(section => observer.observe(section));


//    CARROUSEL INFINI DES IMG
    const highResMapping = {
      'asset/img/low/Insta_Post-Feed.png': 'asset/img/high/Insta_Post-Feed.png',
      'asset/img/low/20231005_154014.png': 'asset/img/high/20231005_154014.jpg',
      'asset/img/low/Posterwall.png': 'asset/img/high/Posterwall.jpg',
    };

    function getHighResVersion(lowResSrc) {
      return highResMapping[lowResSrc] || lowResSrc;
    }

  class VerticalCarousel {
    constructor(trackElement) {
      this.track = trackElement;
      this.slides = Array.from(trackElement.querySelectorAll('.carrousel-slide'));
      this.slideHeight = window.innerHeight - 2 * this.getVh(16.667);
      this.originalSlideCount = this.slides.length - 2;
      this.totalSlides = this.slides.length;
      this.currentIndex = 2;
      this.isScrolling = false;
      this.scrollThreshold = 30; // Seuil plus bas pour détecter plus tôt
      this.scrollAccumulator = 0;
      this.maxScrollDistance = 3; // Nombre max d'images à faire défiler d'un coup
      this.preloadedImages = new Map();

      this.initWithRealFirstImage();
      this.bindEvents();
      this.updateImageQuality();
    }

    // calculateScrollDistance(deltaValue) {
    //   const absValue = Math.abs(deltaValue);
      
    //   console.log('Delta reçu:', deltaValue, 'Valeur absolue:', absValue);
      
    //   // Seuils pour valeurs accumulées sur 50ms
    //   if (absValue < 100) {
    //     console.log('→ Distance: 1');
    //     return 1;
    //   }
    //   if (absValue < 300) {
    //     console.log('→ Distance: 2');
    //     return 2;
    //   }
    //   console.log('→ Distance: 3');
    //   return 3;
    // }

    preloadHighResImage(highResSrc) { // Prend directement l'URL high-res
      if (this.preloadedImages.has(highResSrc)) return Promise.resolve(highResSrc);
      
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => {
          this.preloadedImages.set(highResSrc, highResSrc);
          resolve(highResSrc);
        };
        img.onerror = reject;
        img.src = highResSrc; // Utilise directement l'URL passée en paramètre
      });
    }

      updateImageQuality() {
        this.slides.forEach((slide, index) => {
          const img = slide.querySelector('img');
          if (!img) return;
          
          const currentLowResSrc = img.getAttribute('src');
          
          if (index === this.currentIndex) {
            // Focus frame - charger la high-res
            const highResSrc = getHighResVersion(currentLowResSrc);
            if (highResSrc !== currentLowResSrc) {
              this.preloadHighResImage(highResSrc).then(() => {
                if (index === this.currentIndex) { // Vérifier qu'on est toujours en focus
                  img.src = highResSrc;
                }
              }).catch(() => {
                img.src = currentLowResSrc; // Fallback
              });
            }
          } else {
            // Previous/next frames - utiliser low-res du mapping ou garder l'original
            const lowResSrc = Object.keys(highResMapping).find(key => 
              getHighResVersion(key) === currentLowResSrc
            ) || currentLowResSrc;
            img.src = lowResSrc;
          }
        });
      }

    getVh(vh) {
      return window.innerHeight * (vh / 100);
    }

    initWithRealFirstImage() {
      this.currentIndex = 1; // Vraie première image
      const focusFrameOffset = this.getVh(16.667);
      const gap = this.getVh(4.63);
      const slideWithGap = this.slideHeight + gap;
      
      const targetPosition = focusFrameOffset - (this.currentIndex * slideWithGap);
      this.track.style.transform = `translateY(${targetPosition}px)`;
      this.updateScrollIndicator();
      this.updateImageQuality();
    }

    scrollToSlide(direction, distance = 1) {
      if (this.isScrolling) return;

      this.isScrolling = true;
      this.currentIndex += direction * distance;
      
      // Position corrigée avec espacement entre les images
      const focusFrameOffset = this.getVh(16.667);
      const gap = this.getVh(4.63);
      const slideWithGap = this.slideHeight + gap;
      const targetPosition = focusFrameOffset - (this.currentIndex * slideWithGap);

      this.track.style.transition = 'transform 0.6s ease';
      this.track.style.transform = `translateY(${targetPosition}px)`;

      setTimeout(() => {
        // Gestion des clones pour boucle infinie
        if (this.currentIndex <= 0) {
          // On est sur le clone du début → aller à la vraie dernière image
          this.currentIndex = this.originalSlideCount;
          this.repositionWithoutTransition();
        } else if (this.currentIndex >= this.totalSlides - 1) {
          // On est sur le clone de fin → aller à la vraie première image
          this.currentIndex = 1;
          this.repositionWithoutTransition();
        }
        
        this.updateScrollIndicator();
        this.updateImageQuality();
        this.isScrolling = false;
      }, 600);
    }

    repositionWithoutTransition() {
      const focusFrameOffset = this.getVh(16.667);
      const gap = this.getVh(4.63);
      const slideWithGap = this.slideHeight + gap;
      const targetPosition = focusFrameOffset - (this.currentIndex * slideWithGap);
      
      this.track.style.transition = 'none';
      this.track.style.transform = `translateY(${targetPosition}px)`;
      
      // Force le reflow pour appliquer immédiatement
      this.track.offsetHeight;
    }

    updateScrollIndicator() {
      const indicator = this.track.closest('.carrousel-container').querySelector('.scroll-indicator');
      if (!indicator) return;

      // Utiliser currentIndex - 1 pour exclure le clone du début
      const realIndex = this.currentIndex - 1;
      const progress = (realIndex / (this.originalSlideCount - 1)) * (100 - 20);
      indicator.style.setProperty('--scroll-progress', `${progress}px`);
    }

    

    bindEvents() {
  const scrollZone = this.track.closest('.carrousel-container').querySelector('.scroll-capture');

  let startY = 0;
  let scrollY = 0;

  // Variables pour détecter le type d'input
  let wheelTimeout = null;
  let wheelCount = 0;
  let totalDelta = 0;
  let isTrackpad = false;

  scrollZone.addEventListener('wheel', (e) => {
    e.preventDefault();
    
    wheelCount++;
    totalDelta += Math.abs(e.deltaY);
    const direction = e.deltaY > 0 ? 1 : -1;
    
    // Détection trackpad vs souris basée sur la valeur deltaY
    if (Math.abs(e.deltaY) < 50) {
      isTrackpad = true;
    } else if (Math.abs(e.deltaY) > 100) {
      isTrackpad = false;
    }
    
    if (wheelTimeout) {
      clearTimeout(wheelTimeout);
    }
    
    wheelTimeout = setTimeout(() => {
      if (this.isScrolling) return;
      
      let distance;
      
      if (isTrackpad) {
  // Pour trackpad : calcul plus progressif
  if (totalDelta < 300) distance = 1;
  else if (totalDelta < 800) distance = 1;   // Toujours 1 pour les petits scrolls
  else if (totalDelta < 1800) distance = 2;
  else distance = 3;
} else {
  // Pour souris : inchangé
  if (wheelCount === 1) distance = 1;
  else if (wheelCount <= 3) distance = 2;
  else distance = 3;
}
      
      console.log(`${isTrackpad ? 'Trackpad' : 'Souris'} - Événements: ${wheelCount}, Delta total: ${totalDelta}, Distance: ${distance}`);
      
      this.scrollToSlide(direction, distance);
      wheelCount = 0;
      totalDelta = 0;
    }, isTrackpad ? 150 : 80); // Timeout plus long pour trackpad
  }, { passive: false });

  // Mobile (inchangé)
  scrollZone.addEventListener('touchstart', (e) => {
    startY = e.touches[0].clientY;
    scrollY = 0;
  }, { passive: true });

  scrollZone.addEventListener('touchmove', (e) => {
    e.preventDefault();
    scrollY = e.touches[0].clientY - startY;
  }, { passive: false });

  scrollZone.addEventListener('touchend', () => {
    if (Math.abs(scrollY) > this.scrollThreshold) {
      const direction = scrollY > 0 ? -1 : 1;
      const distance = Math.abs(scrollY) > 200 ? 2 : 1;
      this.scrollToSlide(direction, distance);
    }
  }, { passive: true });
}
  }

  // Lancer tous les carrousels au DOM prêt
  document.addEventListener('DOMContentLoaded', () => {
    const tracks = document.querySelectorAll('.carrousel-track');
    tracks.forEach(track => {
      new VerticalCarousel(track);
    });

    // Injecte style pour .scroll-indicator::after
    const style = document.createElement('style');
    style.textContent = `
      .scroll-indicator::after {
        top: var(--scroll-progress, 0px);
      }
    `;
    document.head.appendChild(style);
  });

</script>


</html>